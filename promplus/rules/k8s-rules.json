  {
    "name": "k8s.rules",
    "rules": [
      {
        "expr": "sum(rate(container_cpu_usage_seconds_total{job=\"kubelet\", image!=\"\", container!=\"POD\"}[5m])) by (namespace)\n",
        "record": "namespace:container_cpu_usage_seconds_total:sum_rate"
      },
      {
        "expr": "sum by (namespace, pod, container) (\n  rate(container_cpu_usage_seconds_total{job=\"kubelet\", image!=\"\", container!=\"POD\"}[5m])\n)\n",
        "record": "namespace_pod_container:container_cpu_usage_seconds_total:sum_rate"
      },
      {
        "expr": "sum(container_memory_usage_bytes{job=\"kubelet\", image!=\"\", container!=\"POD\"}) by (namespace)\n",
        "record": "namespace:container_memory_usage_bytes:sum"
      },
      {
        "expr": "sum by (namespace, label_name) (\n    sum(kube_pod_container_resource_requests_memory_bytes{job=\"kube-state-metrics\"} * on (endpoint, instance, job, namespace, pod, service) group_left(phase) (kube_pod_status_phase{phase=~\"^(Pending|Running)$\"} == 1)) by (namespace, pod)\n  * on (namespace, pod)\n    group_left(label_name) kube_pod_labels{job=\"kube-state-metrics\"}\n)\n",
        "record": "namespace:kube_pod_container_resource_requests_memory_bytes:sum"
      },
      {
        "expr": "sum by (namespace, label_name) (\n    sum(kube_pod_container_resource_requests_cpu_cores{job=\"kube-state-metrics\"} * on (endpoint, instance, job, namespace, pod, service) group_left(phase) (kube_pod_status_phase{phase=~\"^(Pending|Running)$\"} == 1)) by (namespace, pod)\n  * on (namespace, pod)\n    group_left(label_name) kube_pod_labels{job=\"kube-state-metrics\"}\n)\n",
        "record": "namespace:kube_pod_container_resource_requests_cpu_cores:sum"
      },
      {
        "expr": "sum(\n  label_replace(\n    label_replace(\n      kube_pod_owner{job=\"kube-state-metrics\", owner_kind=\"ReplicaSet\"},\n      \"replicaset\", \"$1\", \"owner_name\", \"(.*)\"\n    ) * on(replicaset, namespace) group_left(owner_name) kube_replicaset_owner{job=\"kube-state-metrics\"},\n    \"workload\", \"$1\", \"owner_name\", \"(.*)\"\n  )\n) by (namespace, workload, pod)\n",
        "labels": {
          "workload_type": "deployment"
        },
        "record": "mixin_pod_workload"
      },
      {
        "expr": "sum(\n  label_replace(\n    kube_pod_owner{job=\"kube-state-metrics\", owner_kind=\"DaemonSet\"},\n    \"workload\", \"$1\", \"owner_name\", \"(.*)\"\n  )\n) by (namespace, workload, pod)\n",
        "labels": {
          "workload_type": "daemonset"
        },
        "record": "mixin_pod_workload"
      },
      {
        "expr": "sum(\n  label_replace(\n    kube_pod_owner{job=\"kube-state-metrics\", owner_kind=\"StatefulSet\"},\n    \"workload\", \"$1\", \"owner_name\", \"(.*)\"\n  )\n) by (namespace, workload, pod)\n",
        "labels": {
          "workload_type": "statefulset"
        },
        "record": "mixin_pod_workload"
      }
    ]
  }
